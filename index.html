<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1a1a1a">
<title>Baj√° un cambio</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: #000;
min-height: 100vh;
color: #fff;
display: flex;
flex-direction: column;
}
.header {
background: #1a1a1a;
padding: 20px;
text-align: center;
border-bottom: 1px solid #333;
position: sticky;
top: 0;
z-index: 100;
}
.app-title {
font-size: 1.5rem;
font-weight: 700;
color: #ffff00;
margin-bottom: 5px;
}

.chat-container {
flex: 1;
padding: 20px;
max-width: 600px;
margin: 0 auto;
width: 100%;
display: flex;
flex-direction: column;
gap: 20px;
}
.message-bubble {
padding: 15px 18px;
border-radius: 20px;
max-width: 85%;
word-wrap: break-word;
position: relative;
}
.message-original {
background: #333;
color: #fff;
align-self: flex-end;
margin-left: auto;
border-bottom-right-radius: 5px;
}
.message-transformed {
background: #ffff00;
color: #000;
align-self: flex-start;
border-bottom-left-radius: 5px;
font-weight: 500;
}
.message-label {
font-size: 0.8rem;
font-weight: 600;
margin-bottom: 8px;
opacity: 0.8;
}
.input-section {
position: sticky;
bottom: 0;
background: #1a1a1a;
padding: 20px;
border-top: 1px solid #333;
}
.input-container {
max-width: 600px;
margin: 0 auto;
display: flex;
flex-direction: column;
gap: 15px;
}
.text-input {
background: #333;
border: none;
border-radius: 25px;
padding: 15px 20px;
color: #fff;
font-size: 1rem;
resize: none;
min-height: 50px;
max-height: 120px;
font-family: inherit;
}
.text-input::placeholder {
color: #999;
}
.text-input:focus {
outline: 2px solid #ffff00;
background: #404040;
}

.controls {
display: flex;
gap: 10px;
align-items: center;
}
.mode-select {
flex: 1;
background: #333;
border: none;
border-radius: 20px;
padding: 12px 15px;
color: #f60202;
font-size: 0.9rem;
cursor: pointer;
}
.mode-select:focus {
outline: 2px solid #ffff00;
}
.send-btn {
background: #ffff00;
color: #000;
border: none;
border-radius: 50%;
width: 45px;
height: 45px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 1.2rem;
transition: all 0.2s ease;
flex-shrink: 0;
}
.send-btn:hover:not(:disabled) {
background: #ffff66;
transform: scale(1.05);
}
.send-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}
.loading {
display: flex;
align-items: center;
gap: 10px;
color: #999;
font-size: 0.9rem;
padding: 10px 20px;
}
.loading-dots {
display: inline-flex;
gap: 3px;
}
.loading-dot {
width: 6px;
height: 6px;
background: #999;
border-radius: 50%;
animation: loading 1.4s infinite ease-in-out;
}
.loading-dot:nth-child(1) { animation-delay: -0.32s; }
.loading-dot:nth-child(2) { animation-delay: -0.16s; }
@keyframes loading {
0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
40% { transform: scale(1); opacity: 1; }
}
.copy-btn {
position: absolute;
top: 10px;
right: 10px;
background: rgba(0, 0, 0, 0.7);
color: #fff;
border: none;
border-radius: 15px;
padding: 5px 10px;
font-size: 0.8rem;
cursor: pointer;
opacity: 0;
transition: opacity 0.2s ease;
}
.message-transformed:hover .copy-btn {
opacity: 1;
}
.toast {
position: fixed;
bottom: 100px;
left: 50%;
transform: translateX(-50%);
background: rgba(0, 0, 0, 0.9);
color: #fff;
padding: 10px 20px;
border-radius: 20px;
font-size: 0.9rem;
opacity: 0;
transition: all 0.3s ease;
z-index: 1000;
}
.toast.show {
opacity: 1;
transform: translateX(-50%) translateY(-10px);
}
.empty-state {
text-align: center;
color: #666;
padding: 40px 20px;
font-size: 0.9rem;
}
@media (max-width: 480px) {
.chat-container {
padding: 15px;
}
.input-section {
padding: 15px;
}
.message-bubble {
max-width: 90%;
}
}
</style>
</head>
<body>
<div class="header">
<h1 class="app-title">Baj√° un cambio</h1>
</div>
<div class="chat-container" id="chatContainer">
<div class="empty-state">
Escrib√≠ tu mensaje abajo y te ayudo a "bajar un cambio" ü§ù
</div>
</div>
<div class="input-section">
<div class="input-container">
<textarea
id="messageInput"
class="text-input"
placeholder="Me cans√©, v√°yanse a la put que los pari√≥..."
rows="1"
></textarea>
<div class="controls">
<select id="modeSelect" class="mode-select">
<option value="formal">üíº Formal/Trabajo</option>
<option value="amigable">üòä Amigable</option>
<option value="directo">üí¨ Directo</option>
<option value="diplomatico">ü§ù Diplom√°tico</option>
</select>
<button class="send-btn" id="sendBtn">‚ö°</button>
</div>
</div>
</div>
<div class="loading" id="loading" style="display: none;">
<div class="loading-dots">
<div class="loading-dot"></div>
<div class="loading-dot"></div>
<div class="loading-dot"></div>
</div>
Transformando mensaje...
</div>
<div class="toast" id="toast"></div>

<script>
// Backend endpoint - se auto-detecta seg√∫n el entorno
const BACKEND_URL = window.location.origin + '/api/transform';

const PROMPTS = {
    formal: "Transforma este mensaje en comunicaci√≥n profesional y formal, pero mant√©n el mensaje corto y directo. M√°ximo 2-3 oraciones.",
    amigable: "Convierte este mensaje en algo amigable y c√°lido, pero sin perder la firmeza. M√°ximo 2-3 oraciones.",
    directo: "Haz este mensaje directo pero respetuoso, sin rodeos pero sin ofender. M√°ximo 2-3 oraciones.",
    diplomatico: "Transforma en comunicaci√≥n diplom√°tica y t√°ctica, manteniendo la firmeza. M√°ximo 2-3 oraciones."
};

const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const modeSelect = document.getElementById('modeSelect');
const chatContainer = document.getElementById('chatContainer');
const loading = document.getElementById('loading');
const toast = document.getElementById('toast');

// Auto-resize textarea
messageInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// Enviar con Enter
messageInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

sendBtn.addEventListener('click', sendMessage);

async function sendMessage() {
    const text = messageInput.value.trim();
    if (!text) return;

    const mode = modeSelect.value;

    // Limpiar empty state
    const emptyState = chatContainer.querySelector('.empty-state');
    if (emptyState) {
        emptyState.remove();
    }

    // Agregar mensaje original
    addMessage(text, 'original');

    // Limpiar input
    messageInput.value = '';
    messageInput.style.height = 'auto';

    // Mostrar loading
    showLoading();

    try {
        // Llamada a la API
        const transformedText = await transformText(text, mode);
        hideLoading();
        addMessage(transformedText, 'transformed');
    } catch (error) {
        hideLoading();
        showToast('‚ùå Error al transformar el mensaje');
        console.error('Error completo:', error);
    }
}

function addMessage(text, type) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message-bubble message-${type}`;
    
    if (type === 'original') {
        messageDiv.innerHTML = `
            <div class="message-label">Texto original</div>
            ${text}
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="message-label">Texto bajando un cambio</div>
            ${text}
            <button class="copy-btn" onclick="copyMessage(this)">üìã</button>
        `;
    }
    
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHistory;
}

async function transformText(text, mode) {
    const prompt = `${PROMPTS[mode]}

Texto a transformar: "${text}"

Instrucciones adicionales:
- Mant√©n el mensaje corto (m√°ximo 2-3 oraciones)
- Conserva la intenci√≥n original pero con mejor tono
- Responde SOLO con el texto transformado, sin explicaciones
- Si el texto tiene groser√≠as o insultos, reempl√°zalos por alternativas apropiadas`;

    try {
        console.log('Enviando petici√≥n a:', BACKEND_URL);
        
        const response = await fetch(BACKEND_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                prompt: prompt,
                mode: mode
            })
        });

        console.log('Status de respuesta:', response.status);

        if (!response.ok) {
            const errorText = await response.text();
            console.error('Error del servidor:', errorText);
            throw new Error(`Error ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        console.log('Respuesta del servidor:', data);

        if (!data.result) {
            throw new Error('Respuesta inv√°lida del servidor');
        }

        return data.result.trim().replace(/^["']|["']$/g, '');
    } catch (error) {
        console.error('Error calling backend:', error);
        
        if (error.message.includes('fetch')) {
            throw new Error('Error de conexi√≥n. Verifica que el servidor est√© funcionando.');
        }
        
        throw error;
    }
}

function showLoading() {
    loading.style.display = 'flex';
    sendBtn.disabled = true;
}

function hideLoading() {
    loading.style.display = 'none';
    sendBtn.disabled = false;
}

async function copyMessage(btn) {
    const messageText = btn.parentElement.textContent
        .replace('Texto bajando un cambio', '')
        .replace('üìã', '')
        .trim();
    
    try {
        await navigator.clipboard.writeText(messageText);
        showToast('üìã Copiado al portapapeles');
    } catch (error) {
        showToast('‚ùå Error al copiar');
    }
}

function showToast(message) {
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 2000);
}
</script>
</body>
</html>