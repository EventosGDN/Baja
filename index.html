<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1a1a1a">
<title>Baj√° un cambio</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: #000;
min-height: 100vh;
color: #fff;
display: flex;
flex-direction: column;
position: relative;
overflow-x: hidden;
}

/* Fondo animado de fuego */
.fire-background {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
background: radial-gradient(circle at center bottom, 
    rgba(255, 100, 0, 0.3) 0%,
    rgba(255, 50, 0, 0.2) 20%,
    rgba(200, 0, 0, 0.1) 40%,
    rgba(0, 0, 0, 0.9) 70%,
    rgba(0, 0, 0, 1) 100%);
}

.fire-particles {
position: absolute;
width: 100%;
height: 100%;
overflow: hidden;
}

.fire-particle {
position: absolute;
width: 4px;
height: 4px;
background: radial-gradient(circle, #ff6600, #ff0000);
border-radius: 50%;
opacity: 0;
animation: fireFloat 3s infinite ease-in-out;
}

@keyframes fireFloat {
0% {
opacity: 0;
transform: translateY(100vh) scale(0.5);
}
20% {
opacity: 1;
}
80% {
opacity: 1;
}
100% {
opacity: 0;
transform: translateY(-20vh) scale(1.2);
}
}

/* Meg√°fono flotante */
.megaphone-container {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: -1;
font-size: 120px;
opacity: 0.1;
animation: megaphoneFloat 4s ease-in-out infinite;
pointer-events: none;
}

@keyframes megaphoneFloat {
0%, 100% {
transform: translate(-50%, -50%) rotate(-2deg) scale(1);
}
50% {
transform: translate(-50%, -55%) rotate(2deg) scale(1.05);
}
}

.header {
background: rgba(26, 26, 26, 0.95);
backdrop-filter: blur(10px);
padding: 20px;
text-align: center;
border-bottom: 1px solid #333;
position: sticky;
top: 0;
z-index: 100;
}

.app-title {
font-size: 1.5rem;
font-weight: 700;
color: #ffff00;
margin-bottom: 5px;
text-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
}

.chat-container {
flex: 1;
padding: 20px;
max-width: 600px;
margin: 0 auto;
width: 100%;
display: flex;
flex-direction: column;
gap: 20px;
position: relative;
z-index: 10;
}

.message-bubble {
padding: 15px 18px;
border-radius: 20px;
max-width: 85%;
word-wrap: break-word;
position: relative;
backdrop-filter: blur(5px);
}

.message-original {
background: rgba(51, 51, 51, 0.9);
color: #fff;
align-self: flex-end;
margin-left: auto;
border-bottom-right-radius: 5px;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.message-transformed {
background: rgba(255, 255, 0, 0.95);
color: #000;
align-self: flex-start;
border-bottom-left-radius: 5px;
font-weight: 500;
box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
}

.message-label {
font-size: 0.8rem;
font-weight: 600;
margin-bottom: 8px;
opacity: 0.8;
}

.input-section {
position: sticky;
bottom: 0;
background: rgba(26, 26, 26, 0.95);
backdrop-filter: blur(10px);
padding: 20px;
border-top: 1px solid #333;
z-index: 100;
}

.input-container {
max-width: 600px;
margin: 0 auto;
display: flex;
flex-direction: column;
gap: 15px;
}

.text-input {
background: rgba(51, 51, 51, 0.9);
backdrop-filter: blur(5px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 25px;
padding: 15px 20px;
color: #fff;
font-size: 1rem;
resize: none;
min-height: 50px;
max-height: 120px;
font-family: inherit;
}

.text-input::placeholder {
color: #999;
}

.text-input:focus {
outline: 2px solid #ffff00;
background: rgba(64, 64, 64, 0.9);
box-shadow: 0 0 15px rgba(255, 255, 0, 0.2);
}

.controls {
display: flex;
gap: 10px;
align-items: center;
}

.mode-select {
flex: 1;
background: rgba(51, 51, 51, 0.9);
backdrop-filter: blur(5px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 20px;
padding: 12px 15px;
color: #fff;
font-size: 0.9rem;
cursor: pointer;
}

.mode-select:focus {
outline: 2px solid #ffff00;
box-shadow: 0 0 15px rgba(255, 255, 0, 0.2);
}

.action-buttons {
display: flex;
gap: 8px;
align-items: center;
}

.record-btn {
background: linear-gradient(135deg, #ff4444, #cc0000);
color: #fff;
border: none;
border-radius: 50%;
width: 45px;
height: 45px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 1.2rem;
transition: all 0.2s ease;
flex-shrink: 0;
position: relative;
box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
}

.record-btn:hover:not(:disabled) {
background: linear-gradient(135deg, #ff6666, #ff0000);
transform: scale(1.05);
box-shadow: 0 6px 20px rgba(255, 68, 68, 0.5);
}

.record-btn.recording {
background: linear-gradient(135deg, #ff0000, #cc0000);
animation: pulse 1s infinite;
box-shadow: 0 0 25px rgba(255, 0, 0, 0.7);
}

.record-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.send-btn {
background: linear-gradient(135deg, #ffff00, #cccc00);
color: #000;
border: none;
border-radius: 50%;
width: 45px;
height: 45px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 1.2rem;
transition: all 0.2s ease;
flex-shrink: 0;
box-shadow: 0 4px 15px rgba(255, 255, 0, 0.3);
}

.send-btn:hover:not(:disabled) {
background: linear-gradient(135deg, #ffff66, #ffff00);
transform: scale(1.05);
box-shadow: 0 6px 20px rgba(255, 255, 0, 0.5);
}

.send-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.loading {
display: flex;
align-items: center;
gap: 10px;
color: #999;
font-size: 0.9rem;
padding: 10px 20px;
background: rgba(0, 0, 0, 0.7);
backdrop-filter: blur(5px);
border-radius: 15px;
margin: 0 auto;
width: fit-content;
}

.loading-dots {
display: inline-flex;
gap: 3px;
}

.loading-dot {
width: 6px;
height: 6px;
background: #999;
border-radius: 50%;
animation: loading 1.4s infinite ease-in-out;
}

.loading-dot:nth-child(1) { animation-delay: -0.32s; }
.loading-dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes loading {
0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
40% { transform: scale(1); opacity: 1; }
}

@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.1); }
100% { transform: scale(1); }
}

.copy-btn {
position: absolute;
top: 10px;
right: 10px;
background: rgba(0, 0, 0, 0.7);
color: #fff;
border: none;
border-radius: 15px;
padding: 5px 10px;
font-size: 0.8rem;
cursor: pointer;
opacity: 0;
transition: opacity 0.2s ease;
backdrop-filter: blur(5px);
}

.message-transformed:hover .copy-btn {
opacity: 1;
}

.toast {
position: fixed;
bottom: 100px;
left: 50%;
transform: translateX(-50%);
background: rgba(0, 0, 0, 0.9);
backdrop-filter: blur(10px);
color: #fff;
padding: 10px 20px;
border-radius: 20px;
font-size: 0.9rem;
opacity: 0;
transition: all 0.3s ease;
z-index: 1000;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.toast.show {
opacity: 1;
transform: translateX(-50%) translateY(-10px);
}

.audio-status {
display: flex;
align-items: center;
gap: 8px;
color: #ff4444;
font-size: 0.9rem;
margin-top: 10px;
opacity: 0;
transition: opacity 0.3s ease;
background: rgba(0, 0, 0, 0.7);
backdrop-filter: blur(5px);
padding: 8px 15px;
border-radius: 15px;
border: 1px solid rgba(255, 68, 68, 0.3);
}

.audio-status.show {
opacity: 1;
}

.recording-timer {
font-weight: 600;
color: #ffff00;
}

.empty-state {
text-align: center;
color: #666;
padding: 40px 20px;
font-size: 0.9rem;
background: rgba(0, 0, 0, 0.3);
backdrop-filter: blur(5px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.1);
}

@media (max-width: 480px) {
.megaphone-container {
font-size: 80px;
}

.chat-container {
padding: 15px;
}

.input-section {
padding: 15px;
}

.message-bubble {
max-width: 90%;
}

.action-buttons {
gap: 6px;
}

.record-btn, .send-btn {
width: 40px;
height: 40px;
font-size: 1.1rem;
}
}
</style>
</head>
<body>
<!-- Fondo animado de fuego -->
<div class="fire-background">
<div class="fire-particles" id="fireParticles"></div>
</div>

<!-- Meg√°fono flotante -->
<div class="megaphone-container">
üì¢
</div>

<div class="header">
<h1 class="app-title">Baj√° un cambio</h1>
</div>

<div class="chat-container" id="chatContainer">
<div class="empty-state">
Escrib√≠ tu mensaje o grab√° un audio y te ayudo a "bajar un cambio" 
</div>
</div>

<div class="input-section">
<div class="input-container">
<textarea
id="messageInput"
class="text-input"
placeholder="Me cans√©, v√°yanse a la put que los pari√≥... o grab√° un audio"
rows="1"
></textarea>

<div class="controls">
<select id="modeSelect" class="mode-select">
<option value="formal">üíº Formal/Trabajo</option>
<option value="amigable">üòä Amigable</option>
<option value="directo">üí¨ Directo</option>
<option value="diplomatico">ü§ù Diplom√°tico</option>
</select>
<div class="action-buttons">
<button class="record-btn" id="recordBtn" title="Grabar audio">üéôÔ∏è</button>
<button class="send-btn" id="sendBtn" title="Enviar mensaje">‚ö°</button>
</div>
</div>
<div class="audio-status" id="audioStatus">
<span>üî¥ Grabando...</span>
<span class="recording-timer" id="recordingTimer">00:00</span>
</div>
</div>
</div>

<div class="loading" id="loading" style="display: none;">
<div class="loading-dots">
<div class="loading-dot"></div>
<div class="loading-dot"></div>
<div class="loading-dot"></div>
</div>
<span id="loadingText">Transformando mensaje...</span>
</div>

<div class="toast" id="toast"></div>

<script>
// Crear part√≠culas de fuego
function createFireParticles() {
const container = document.getElementById('fireParticles');
const particleCount = 20;

for (let i = 0; i < particleCount; i++) {
const particle = document.createElement('div');
particle.className = 'fire-particle';
particle.style.left = Math.random() * 100 + '%';
particle.style.animationDelay = Math.random() * 3 + 's';
particle.style.animationDuration = (2 + Math.random() * 2) + 's';
container.appendChild(particle);
}
}

// Inicializar part√≠culas al cargar la p√°gina
document.addEventListener('DOMContentLoaded', () => {
createFireParticles();
});

// Backend endpoints - Simulaci√≥n para demostraci√≥n
const TRANSFORM_URL = '/api/transform';
const TRANSCRIBE_URL = '/api/transcribe';

const PROMPTS = {
formal: "Transforma este mensaje en comunicaci√≥n profesional y formal, pero mant√©n el mensaje corto y directo. M√°ximo 2-3 oraciones.",
amigable: "Convierte este mensaje en algo amigable y c√°lido, pero sin perder la firmeza. M√°ximo 2-3 oraciones.",
directo: "Haz este mensaje directo pero respetuoso, sin rodeos pero sin ofender. M√°ximo 2-3 oraciones.",
diplomatico: "Transforma en comunicaci√≥n diplom√°tica y t√°ctica, manteniendo la firmeza. M√°ximo 2-3 oraciones."
};

// Variables para grabaci√≥n de audio
let mediaRecorder = null;
let audioChunks = [];
let isRecording = false;
let recordingTimer = null;
let recordingStartTime = null;

// Elementos del DOM
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const recordBtn = document.getElementById('recordBtn');
const modeSelect = document.getElementById('modeSelect');
const chatContainer = document.getElementById('chatContainer');
const loading = document.getElementById('loading');
const loadingText = document.getElementById('loadingText');
const toast = document.getElementById('toast');
const audioStatus = document.getElementById('audioStatus');
const recordingTimerElement = document.getElementById('recordingTimer');

// Auto-resize textarea
messageInput.addEventListener('input', function() {
this.style.height = 'auto';
this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// Enviar con Enter
messageInput.addEventListener('keydown', function(e) {
if (e.key === 'Enter' && !e.shiftKey) {
e.preventDefault();
sendMessage();
}
});

// Event listeners
sendBtn.addEventListener('click', sendMessage);
recordBtn.addEventListener('click', toggleRecording);

// Funci√≥n de demostraci√≥n para transformar texto
async function transformText(text, mode) {
// Simulaci√≥n de transformaci√≥n para demostraci√≥n
const transformations = {
formal: {
"Me cans√©, v√°yanse a la put que los pari√≥": "He decidido que es momento de finalizar esta colaboraci√≥n. Les agradezco su comprensi√≥n.",
"Esto es una porquer√≠a": "Considero que este proyecto necesita mejoras significativas para cumplir con los est√°ndares esperados.",
"No me rompan las pelotas": "Por favor, necesito concentrarme en mis tareas sin interrupciones."
},
amigable: {
"Me cans√©, v√°yanse a la put que los pari√≥": "Che, estoy bastante agotado. ¬øPodemos seguir esto ma√±ana? Gracias por entender.",
"Esto es una porquer√≠a": "La verdad que esto no est√° funcionando como esperaba. ¬øPodemos intentar otro enfoque?",
"No me rompan las pelotas": "Disculpen, pero necesito un ratito para concentrarme. ¬°Gracias!"
},
directo: {
"Me cans√©, v√°yanse a la put que los pari√≥": "Necesito un descanso. Retomamos ma√±ana.",
"Esto es una porquer√≠a": "Esto no funciona. Hay que cambiarlo.",
"No me rompan las pelotas": "Necesito concentrarme. Sin interrupciones, por favor."
},
diplomatico: {
"Me cans√©, v√°yanse a la put que los pari√≥": "Creo que ser√≠a productivo hacer una pausa estrat√©gica y retomar con energ√≠as renovadas.",
"Esto es una porquer√≠a": "Sugiero revisar nuestra estrategia actual para optimizar los resultados esperados.",
"No me rompan las pelotas": "Agradecer√≠a poder mantener un ambiente de trabajo enfocado para maximizar la productividad."
}
};

// Buscar transformaci√≥n exacta o usar una gen√©rica
const modeTransforms = transformations[mode];
const result = modeTransforms[text] || 
    `Versi√≥n ${mode}: ${text.replace(/porquer√≠a|mierda|put[ao]/gi, 'problema').replace(/cans√©/gi, 'necesito un descanso')}`;
    
return result;
}

// Enviar mensaje de texto
async function sendMessage() {
const text = messageInput.value.trim();
if (!text) return;

await processTextMessage(text);
messageInput.value = '';
messageInput.style.height = 'auto';
}

// Procesar mensaje de texto
async function processTextMessage(text) {
const mode = modeSelect.value;

// Limpiar empty state si existe
const emptyState = chatContainer.querySelector('.empty-state');
if (emptyState) {
emptyState.remove();
}

// Agregar mensaje original
addMessage(text, 'original');

// Mostrar loading
showLoading('Transformando mensaje...');

try {
// Simular delay de API
await new Promise(resolve => setTimeout(resolve, 1500));
const transformedText = await transformText(text, mode);
hideLoading();
addMessage(transformedText, 'transformed');
} catch (error) {
hideLoading();
showToast('‚ùå Error al transformar el mensaje');
console.error(error);
}
}

// Agregar mensaje al chat
function addMessage(text, type) {
const messageDiv = document.createElement('div');
messageDiv.className = `message-bubble message-${type}`;

if (type === 'original') {
messageDiv.innerHTML = `
<div class="message-label">Texto original</div>
${text}
`;
} else {
messageDiv.innerHTML = `
<div class="message-label">Texto bajando un cambio</div>
${text}
<button class="copy-btn" onclick="copyMessage(this)">üìã</button>
`;
}

chatContainer.appendChild(messageDiv);
chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Mostrar/ocultar loading
function showLoading(message = 'Transformando mensaje...') {
loadingText.textContent = message;
loading.style.display = 'flex';
sendBtn.disabled = true;
recordBtn.disabled = true;
}

function hideLoading() {
loading.style.display = 'none';
sendBtn.disabled = false;
recordBtn.disabled = false;
}

// Copiar mensaje
async function copyMessage(btn) {
const messageText = btn.parentElement.textContent
.replace('Texto bajando un cambio', '')
.replace('üìã', '')
.trim();

try {
await navigator.clipboard.writeText(messageText);
showToast('üìã Copiado al portapapeles');
} catch (error) {
showToast('‚ùå Error al copiar');
}
}

// Mostrar toast
function showToast(message) {
toast.textContent = message;
toast.classList.add('show');
setTimeout(() => {
toast.classList.remove('show');
}, 2000);
}

// Toggle grabaci√≥n (simulado)
async function toggleRecording() {
if (!isRecording) {
startRecording();
} else {
stopRecording();
}
}

// Iniciar grabaci√≥n (simulado)
function startRecording() {
isRecording = true;
recordBtn.classList.add('recording');
audioStatus.classList.add('show');
recordingStartTime = Date.now();
updateRecordingTimer();
recordingTimer = setInterval(updateRecordingTimer, 1000);
showToast('üé§ Grabando audio...');
}

// Detener grabaci√≥n (simulado)
function stopRecording() {
isRecording = false;
recordBtn.classList.remove('recording');
audioStatus.classList.remove('show');
clearInterval(recordingTimer);
showToast('‚èπ Procesando audio...');

// Simular transcripci√≥n despu√©s de 2 segundos
setTimeout(() => {
const simulatedTranscription = "Este es un ejemplo de transcripci√≥n de audio";
processTextMessage(simulatedTranscription);
}, 2000);
}

// Actualizar timer de grabaci√≥n
function updateRecordingTimer() {
if (recordingStartTime) {
const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
const minutes = Math.floor(elapsed / 60);
const seconds = elapsed % 60;
recordingTimerElement.textContent = 
`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}
}

// Inicializar cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', () => {
// Verificar soporte de grabaci√≥n de audio
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
recordBtn.style.display = 'none';
showToast('‚ö† Grabaci√≥n de audio no soportada en este navegador');
}
});
</script>
</body>
</html>